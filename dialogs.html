<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<link rel="stylesheet" href="dialog.css">
</head>
<body>

<div id="map" class="map"></div>

<script>

function createDialog(dialogPlacement,headerHtml,dialogContent,footerHtml,decoration,modal,positionArray) {
    // dialogPlacement    string, "Center" or "Bottom" or "Left". Placing on screen.
    // headerHtml         string, HTML. Must be '' or non-empty. Undefined is not allowed.
    // dialogContent      string, HTML and JS. The contents of the dialog.
    // footerHtml         string, HTML. Must be '' or non-empty. Undefined is not allowed.
    // decoration         boolean. True enables CSS classes
    //                    .footerCenterDecorated or .footerBottomDecorated
    // modal              boolean, if true then grayed out deactivated screen, else normal
    // positionArray      optional, only used for Center Palette, array [left,top,xlate,ylate] (percentages)
    //                        center top: [50,15,-50,0]
    //                        center center: [50,50,-50,-50]

    // choose dialog style sheet
    var dialogMode;	// modal window or tool palette
    var dialogStyle;	// Left, Bottom or Center placement (Center=freely positionable)
    var footerStyle;	// decorated or not; different decoration styles for dialogStyles.

    // 1) center, bottom or left
    switch (dialogPlacement) {
        case "Center":   dialogStyle = "content-center";
 
                         if (decoration===true) footerStyle="dialogFooterCenterDecorated";
                         else footerStyle="dialogFooterCenter";

                         var left; var top; var xlate; var ylate;
                         if ( positionArray === undefined ) {
                            left="50"; top="50"; xlate="-50"; ylate="-50";
                         } else {
                            left=positionArray[0]; top=positionArray[1];
                            xlate=positionArray[2]; ylate=positionArray[3];
                         }
                         break;;
        case "Bottom":   dialogStyle = "content-bottom";
                         if (decoration===true) footerStyle="dialogFooterBottomDecorated";
                         else footerStyle="dialogFooterBottom";
                         break;;
        case "Left":     dialogStyle = "content-left";
                         if (decoration===true) footerStyle="dialogFooterLeftDecorated";
                         else footerStyle="dialogFooterLeft";
                         break;;
        default:         dialogStyle = "content-center"; // Error
                         footerStyle= "footerCenter"; // Error
    }

    // 2) palette or modal window
    dialogMode="modal";                     // default: greyed out inactive screen
    if (!modal) dialogMode="palette";       // alternative: keep whole UI usable
 
    // BUILD THE DIALOG
    //
    // dialog                [div] modal or palette styles
    //   dialogContent       [div] 80% max 10cm OR 100% slide in from bottom/left
    //     dialogHeader      [div] padding to keep X away from corner
    //       closeBox        [span] float right
    //         closeBtn      [textnode] &times;
    //       headerHTMLnode  [div]
    //         innerHTML     header text as argument
    //     dialogPayload     [div] padding 10
    //       innerHTML       content created by psgeo
    //     dialogFooter      [div]
    //       footerHTMLnode  [div]
    //         innerHTML     footer text as argument
    //
    // NOTE: dialog, dialogHeader, dialogPayload, dialogFooter contain
    //       either "Center" or "Bottom" or "Left" to assert id uniqueness.
    //       Same applies to dialog style and footer style and
    //       in addition there are optional decorated footer styles.
    //
    // NOTE: 
    //       Z=2    Modal window / dialogs
    //       Z=1    Palette windows stacked in order of appearance in dom (now fixed order, could be dynamic)
    //       Z=0    Google Maps
    //       Z=-1   Palette window containers (do not cover Z=0 even when visible)

    var closeBtn = document.createTextNode("\u00d7");
    var closeBox = document.createElement('span');
        closeBox.setAttribute("class","close");
        closeBox.appendChild(closeBtn);
        closeBox.onclick = function() { dialog.style.display = "none"; }
    var dialogHeader = document.createElement("div");
        dialogHeader.setAttribute("class", "dialogHeader");
        dialogHeader.setAttribute("id", "dialogHeader"+dialogPlacement);
        dialogHeader.appendChild(closeBox);
    if (headerHtml != '' ) {
    var headerHtmlNode = document.createElement("div");
        headerHtmlNode.innerHTML=headerHtml;
        dialogHeader.appendChild(headerHtmlNode);
        }
    var dialogPayload = document.createElement("div");
        dialogPayload.setAttribute("class", "dialogPayload");
        dialogPayload.setAttribute("id", "dialogPayload"+dialogPlacement);
        dialogPayload.innerHTML=dialogContent;
    var dialogFooter = document.createElement("div");
        dialogFooter.setAttribute("class", footerStyle); // FOOTER STYLE
        dialogFooter.setAttribute("id", "dialogFooter"+dialogPlacement);
    if (footerHtml != '' ) {
    var footerHtmlNode = document.createElement("div");
        footerHtmlNode.innerHTML=footerHtml;
        dialogFooter.appendChild(footerHtmlNode);
        }
    var content = document.createElement('div');
        content.setAttribute("class", dialogStyle);
        content.appendChild(dialogHeader);
        content.appendChild(dialogPayload);
        content.appendChild(dialogFooter);

    var dialog = document.createElement('div');
        dialog.setAttribute("class", dialogMode); // class: modal or palette
        dialog.setAttribute("id", dialogMode+dialogPlacement); 
        dialog.appendChild(content);

    if ( dialogMode == "modal" ) {
        dialog.addEventListener("click", function(e){
           // Only close modal windows by clicking on background. Palettes require a click on the X !
           if (e.target == modalBottom || e.target == modalCenter || e.target == modalLeft) { 
               e.target.style.display='none'; }
        }, false);
    } 

    if ( dialogPlacement == "Center" ) {
        console.log("dialogMode: "+dialogMode+" dialogPlacement: "+dialogPlacement);

        // calculate absolute margins
        console.log("Calculating absolute position for "+left+"% left margin of window inner width.");
        var xpos=((window.innerWidth/100)*left);
            xpos=xpos.toFixed(0); // round to integer 
            console.log("screen: " + window.innerWidth + "px. " + left + "% margin is " + xpos + "px. Rounded to integer.");
        console.log("Calculating absolute position for "+top+"% top margin of window inner height.");
        var ypos=(window.innerHeight/100)*top;
            ypos=ypos.toFixed(0); // round to integer
            console.log("screen: " + window.innerHeight + "px. " + top + "% margin is " + ypos + "px. Rounded to integer.");

        if (!modal) {        
            //   dialog.style.left=xpos+"px";
            //   dialog.style.top=ypos+"px";
            //   dialog.style.transform="translate("+xlate+"%,"+ylate+"%)";
            dialog.style.transform="translate("+xpos+"px,"+ypos+"px) translate("+xlate+"%,"+ylate+"%)";
            // allow dragging
            dragElement(dialog);
        } else {
            // for some reason left: and top: margins are ignored
            // (they SHOULD work with fixed too, but no!)
            content.style.transform="translate("+xpos+"px,"+ypos+"px) translate("+xlate+"%,"+ylate+"%)";
        }
    }
    return (dialog);
}

//////////////////////////////////////////////////////////////////////////

function dragElement(elmnt) {
    // USAGE: dragElement(document.getElementById("mydiv"));
    // NOTE:  mydiv must have: position absolute !
    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        pos3 = e.clientX; // mouse cursor position
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
    }
    function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // set the element's new position:
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }
    function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
    }
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    elmnt.onmousedown = dragMouseDown;
}
//////////////////////////////////////////////////////////////////////////
function touchDragElement(container,elmnt) {

    // KESKEN !!!
    var dragItem = elmnt;
    // var container = document.querySelector("#container");
    var active = false;
    var currentX;
    var currentY;
    var initialX;
    var initialY;
    var xOffset = 0;
    var yOffset = 0;

    // var container = dragItem; /* temporary */

    // touch
    container.addEventListener("touchstart", dragStart, false);
    container.addEventListener("touchend", dragEnd, false);
    container.addEventListener("touchmove", drag, false);
    // mouse
    container.addEventListener("mousedown", dragStart, false);
    container.addEventListener("mouseup", dragEnd, false);
    container.addEventListener("mousemove", drag, false);

    function dragStart(e) {
      if (e.type === "touchstart") {
        initialX = e.touches[0].clientX - xOffset;
        initialY = e.touches[0].clientY - yOffset;
      } else {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
      }
      if (e.target === dragItem) active = true;
    }

    function dragEnd(e) {
      initialX = currentX;
      initialY = currentY;
      active = false;
    }

    function drag(e) {
      if (active) {
        e.preventDefault();
        if (e.type === "touchmove") {
          currentX = e.touches[0].clientX - initialX;
          currentY = e.touches[0].clientY - initialY;
        } else {
          currentX = e.clientX - initialX;
          currentY = e.clientY - initialY;
        }
        xOffset = currentX;
        yOffset = currentY;
        setTranslate(currentX, currentY, dragItem);
      }
    }

    function setTranslate(xPos, yPos, el) {
      el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
    }
}

//////////////////////////////////////////////////////////////////////////

    // CREATE DIALOGS 
    var statsLine1='<p align="center">Centered text 1 2 3 4 5 6 7 8 9</p>';
    var statsLine2='Left aligned text 1 2 3 4 5 6 7 8 9';
    var statsLine3='1 2 3 4 5';
    var filterContent1="Testi! Testi! Testi! Testi! Testi! Testi! Testi! Testi! Testi!";
    var filterContent2="TESTI! TESTI! TESTI! TESTI!<br>TESTI! TESTI! TESTI! TESTI!";
    var filterContent3="TESTI! TESTI!<br>TESTI! TESTI!<br>TESTI! TESTI!<br>TESTI! TESTI!";

    var filterDialogCenter = new createDialog("Center",'<h3>Modal</h3>',filterContent1,statsLine1,true,true,[50,50,-50,-50]);
    var filterDialogBottom = new createDialog("Bottom",'<h3>Modal</h3>',filterContent2,statsLine2,true,true);
    var filterDialogLeft = new createDialog("Left",'<h3>Modal</h3>',filterContent3,statsLine3,true,true);

    var filterPaletteCenter = new createDialog("Center",'<h3>Drag Me</h3>',filterContent1,statsLine1,true,false,[50,50,-50,-50]);
    var filterPaletteBottom = new createDialog("Bottom",'<h3>Palette</h3>',filterContent2,statsLine2,true,false);
    var filterPaletteLeft = new createDialog("Left",'<h3>Palette</h3>',filterContent3,statsLine3,true,false);

    // PLACE DIALOGS IN DOM
    document.getElementById("map").appendChild(filterDialogCenter); //document.body.appendChild...
    document.getElementById("map").appendChild(filterDialogBottom);
    document.getElementById("map").appendChild(filterDialogLeft);
    document.getElementById("map").appendChild(filterPaletteCenter); //document.body.appendChild...
    document.getElementById("map").appendChild(filterPaletteBottom);
    document.getElementById("map").appendChild(filterPaletteLeft);

    // OPEN/CLOSE PROGRAMMATICALLY
    //    filterDialogBottom.style.display='block';
    //    filterDialogBottom.style.display='none';
    //    OR getElementById("dialogBottom")

    // CREATE OPEN BUTTONS
    var br = document.createElement("br");
    var opentext1 = document.createTextNode("AVAA MODAALI KESKELLE");
    var openBtn1 = document.createElement("button");
        openBtn1.appendChild(opentext1);
        openBtn1.onclick = function() { filterDialogCenter.style.display = "block"; }
    var opentext2 = document.createTextNode("AVAA MODAALI ALAS");
    var openBtn2 = document.createElement("button");
        openBtn2.appendChild(opentext2);
        openBtn2.onclick = function() { filterDialogBottom.style.display = "block"; }
    var opentext3 = document.createTextNode("AVAA MODAALI VASEMMALLE");
    var openBtn3 = document.createElement("button");
        openBtn3.appendChild(opentext3);
        openBtn3.onclick = function() { filterDialogLeft.style.display = "block"; }
    document.body.appendChild(openBtn1); // center (lowest palette)
    document.body.appendChild(openBtn2); // down (medium palette)
    document.body.appendChild(openBtn3); // left (topmost palette)
    document.body.appendChild(br);
    var opentext4 = document.createTextNode("AVAA PALETTI KESKELLE");
    var openBtn4 = document.createElement("button");
        openBtn4.appendChild(opentext4);
        openBtn4.onclick = function() { filterPaletteCenter.style.display = "block"; }
    var opentext5 = document.createTextNode("AVAA PALETTI ALAS");
    var openBtn5 = document.createElement("button");
        openBtn5.appendChild(opentext5);
        openBtn5.onclick = function() { filterPaletteBottom.style.display = "block"; }
    var opentext6 = document.createTextNode("AVAA PALETTI VASEMMALLE");
    var openBtn6 = document.createElement("button");
        openBtn6.appendChild(opentext6);
        openBtn6.onclick = function() { filterPaletteLeft.style.display = "block"; }
    document.body.appendChild(openBtn4); // center (lowest palette)
    document.body.appendChild(openBtn5); // down (medium palette)
    document.body.appendChild(openBtn6); // left (topmost palette)

</script>
</body>
</html>
